@@include('../../inc/top.html')
<body>
<div id="wrap">
  @@include('../../inc/header.html')
  <div class="con_wrap">
     @@include('../../inc/warning/lnb.html')
     <main class="contents">
        <div class="panel_wrap addr">
          <section class="panel panel_main">
            <header class="tit">
              <h1>주소록 관리</h1>
            </header>
            <div class="panel_content">      
              <div class="lst_status all_lst_ctrl">
                <label for="all" class="all"><input type="checkbox" id="all">전체선택</label>
                <div class="tool">
                  <button type="button" class="btn_skyblue" data-click="add_group">그룹추가</button>               
                </div>
              </div>
              <ul  id="addrLst" class="addr_lst lst_ctrl">
                <li>
                  <strong>
                    <label for="dong1"><input type="checkbox">이·통·반장</label>
                    <button type="button" class="btn_modify" title="수정" data-clickevt="modify">수정</button>
                    <button type="button" class="btn_cross" title="삭제" data-clickevt="del">삭제</button>
                  </strong>
                </li>
                <li>
                  <strong>
                    <label for=""><input type="checkbox">재난도우미</label>
                    <button type="button" class="btn_modify" title="수정" data-clickevt="modify">수정</button>
                    <button type="button" class="btn_cross" title="삭제" data-clickevt="del">삭제</button>
                  </strong>
                </li>
                <li>
                  <strong>
                    <label for=""><input type="checkbox">노인도우미</label>
                    <button type="button" class="btn_modify" title="수정" data-clickevt="modify">수정</button>
                    <button type="button" class="btn_cross" title="삭제" data-clickevt="del">삭제</button>
                  </strong>
                </li>
              </ul>
            </div>
          </section>
          <section class="panel panel_sub">
            <div class="panel_content flex_panel">
              <div class="search_area">                
                <ul class="search">                               
                  <li>
                    <select title="검색 유형" id="">
                      <option value="">성명</option>
                      <option value="">그룹명</option>
                    </select>
                    <input type="text" title="검색어" placeholder="검색어" id="">
                    <button type="button" class="btn_skyblue" onclick="search();">검색</button>
                  </li>
                </ul>
              </div>
              <div class="tbl_area">                
                <div class="tbl_top">
                  <p>
                    전체 <span id="count_all">556</span>건 /
                    <b class="font_blue">(<span id="count_R">0</span>개 선택됨)</b>
                  </p>
                  <div class="tool">
                    <button type="button" class="btn_txt" onclick="document.querySelector('#pop_addrAdmin').show()">연락처 추가</button>
                    <button type="button" class="btn_txt" onclick="document.querySelector('#pop_addrAdmin').show()">선택수정</button>
                    <button type="button" class="btn_txt">선택삭제</button>
                    <button type="button" class="btn_txt">주소록 복사???</button>
                    <span class="divide">
                      <button type="button" class="btn_green">엑셀 업로드</button>
                      <button type="button" class="btn_greenline">엑셀 다운로드</button>
                    </span>
                  </div>
                </div>
                <div class="tbl_wrap">
                  <table class="tbl_default">
                    <thead>
                      <tr>
                        <th scope="col"><input type="checkbox" title="전체선택" class="all_check row_check"></th>
                        <th scope="col">번호</th>
                        <th scope="col">그룹</th>
                        <th scope="col">성명</th>
                        <th scope="col">모바일</th>
                        <th scope="col">전화번호</th>
                        <th scope="col">팩스</th>
                        <th scope="col">이메일</th>
                        <th scope="col">소속</th>
                        <th scope="col">직위</th>
                        <th scope="col">직급</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td><input type="checkbox" title="줄선택" class="row_check"></td>
                        <td>1</td>
                        <td><span class="tag_group">2023년 재난도우미</span></td>
                        <td>고길동</td>
                        <td>010-1234-5678</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                      </tr>
                      <tr>
                        <td><input type="checkbox" title="줄선택" class="row_check"></td>
                        <td>2</td>
                        <td><span class="tag_group">이·통·반장</span><span class="tag_group">재난도우미</span><span class="tag_group">노인도우미</span></td>
                        <td>둘리</td>
                        <td>010-1234-5678</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </section>
        </div>
     </main>
  </div>
</div>
<dialog id="pop_addrAdmin" class="pop_addrAdmin" style="--width:600px">
  <div class="p_header">
    <h1>연락처 추가 및 수정</h1>
    <button type="button" class="btn_cross">닫기</button>
  </div>
  <div class="p_body">    
    <dl class="dl_list">
      <dt><label for="" class="required">그룹</label></dt>
      <dd><select name="" id=""><option value="">선택</option></select></dd>
      <dd>
        <span class="tag_group">이·통·반장<button type="button" class="btn_cross" onclick="">선택해제</button></span>
        <span class="tag_group">재난도우미<button type="button" class="btn_cross" onclick="">선택해제</button></span></dd>
      <dt><label for="" class="required">성명</label></dt>
      <dd><input type="text"></dd>
      <dt><label for="" class="required">모바일</label></dt>
      <dd><input type="text"></dd>
      <dt><label for="">전화번호</label></dt>
      <dd><input type="text"></dd>
      <dt><label for="">팩스</label></dt>
      <dd><input type="text"></dd>
      <dt><label for="">이메일</label></dt>
      <dd><input type="text"></dd>
      <dt><label for="">소속</label></dt>
      <dd><input type="text"></dd>
      <dt><label for="">직위</label></dt>
      <dd><input type="text"></dd>
      <dt><label for="">직급</label></dt>
      <dd><input type="text"></dd>      
      <dt><label for="">비고</label></dt>
      <dd><textarea name="" id="" rows="1"></textarea></dd>
    </dl>
    <div class="p_foot">
      <button type="button" class="btn_blue" onclick="">저장</button>
      <button type="button" class="btn_gray" onclick="">취소</button>
    </div>
  </div>
</dialog>
@@include('../../inc/script.html')
<script>
  $('#addrLst').sortable({placeholder: "ui-state-highlight"});
  $.editNewBox = function () {
    const editIptWrap = $(this).parent('strong')
    let editedIpt = $(this).val()
    if (editedIpt === '') editedIpt = '새그룹 '
    let btns = `<button type="button" class="btn_modify" title="수정" data-clickevt="modify">수정</button>
                <button type="button" class="btn_cross" title="삭제" data-clickevt="del">삭제</button>`
    let html =`<label for=""><input type="checkbox">${editedIpt}</label>${btns}`;
    $(editIptWrap).html(html).children('[type="text"]').remove()
  }
  // add item
  const iptEvt = ipt => {
    const value = ipt.val();
    ipt.focus()   
    if(value != '') ipt.val('');
    ipt.val(value);//커서 맨뒤로 보내기
    ipt.focusout($.editNewBox)
    ipt.on('keydown', function (e) {
      if (e.keyCode == 13) ipt.focusout()
    })
  }
  const confirmBtn = `<button type="button" class="btn_grayline">확인</button>`;
  $('[data-click="add_group"]').on('click', function () {
    const target = $(this).parents('.panel_content').find('.addr_lst');
    const addLi = document.createElement('li');
    const newBtn = `<button type="button">그룹 접기/열기</button>`;
    let tmpl = `<strong><input type='text' placeholder='새그룹'>${confirmBtn}</strong>`;   
    addLi.innerHTML = tmpl;
    const ipt = target.append(addLi).find('[type="text"]')
    iptEvt(ipt)
  })
  // delete,edit item
  $('.addr_lst').on('click', '[data-clickevt]', function (e) {
    let btnType = e.target.dataset.clickevt;
    console.log(btnType)
    if (btnType == 'del') {
      !confirm(
          '선택한 그룹을 정말 삭제하시겠습니까? \n 해당 그룹에 속한 연락처는 어떻게 되나요??'
      )
        ? alert('취소 되었습니다.')
        : $(this).parentsUntil('ul').remove();
    } else if (btnType == 'modify') {
      const target = $(this).parentsUntil('li')
      const getTxt = target.find('label')
          .contents()
          .filter(function () {
            return this.nodeType === 3 // Select only text nodes
          })
          .text()
          .trim();
      let editNewIpt = `<input type="text" value="${getTxt}" />${confirmBtn}`;
      const editIpt = target.html(editNewIpt).find('input')
      iptEvt(editIpt)
    }
  })
</script>
</body>
</html>
